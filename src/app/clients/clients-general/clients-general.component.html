<div class="fondoGris">
  <mat-drawer-container class="screen">
    <div class="p-3">
      <div class="d-flex align-items-center justify-content-between m-3">
        <!-- titulo de cliente -->
        <div class="d-flex align-items-center color-dark justify-content-start">
          <mat-icon>people</mat-icon>
          <h1 class="mb-0 ps-2 page-heading">Clientes</h1>
        </div>
        <!-- boton de filtrado -->
        <div class="d-flex align-items-center gap-2">
          <button matTooltip="Ver en Mapa" class="btn buttons-clients d-flex justify-content-center align-items-center" (click)="verEnMapa()">
            <mat-icon class="p-0 m-0">map</mat-icon>
            <span class="ms-1">Mapa</span>
          </button>
          <button class="btn buttons-clients d-flex align-items-center" title="Ver Filtros" (click)="drawer.toggle()">
            <i class="bi bi-funnel-fill p-0 m-0"></i>
            <span class="ms-1">Filtros</span>
          </button>
        </div>
      </div>
      <div class="pt-4">
        <!-- TABLA -->
        <div class="table-responsive">
          <table class="table table-striped">
            <thead class="thead-dark">
              <tr>
                <th scope="col">
                  <input type="checkbox" (change)="masterToggle()" [checked]="isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()" />
                </th>
                <th scope="col" (click)="sort.setSort('codigo')">Código</th>
                <th scope="col" (click)="sort.setSort('cliente')">Cliente</th>
                <th scope="col" (click)="sort.setSort('poblacion')">Población</th>
                <th scope="col" (click)="sort.setSort('provincia')">Provincia</th>
                <th scope="col" (click)="sort.setSort('cp')">C.P.</th>
                <th scope="col">Detalles</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of dataSource.data">
                <td>
                  <input type="checkbox" (click)="$event.stopPropagation()" (change)="selection.toggle(row)" [checked]="selection.isSelected(row)" />
                </td>
                <td>{{ row.id }}</td>
                <td>{{ row.nombre_empresa }}</td>
                <td>{{ row.nombre_poblacion }}</td>
                <td>{{ row.nombre_provincia }}</td>
                <td>{{ row.CP }}</td>
                <td>
                  <button type="button" class="btn btn-primary btn-sm" (click)="openDetailsDialog(row)">
                    Ver
                  </button>
                </td>
              </tr>
              <tr *ngIf="dataSource.data.length === 0">
                <td colspan="7" class="text-center">No hay datos disponibles</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Paginador -->
        <nav aria-label="Page navigation" *ngIf="dataSource.data.length > 0">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="paginator.pageIndex === 0">
              <a class="page-link" href="#" (click)="paginator.firstPage()">Primera</a>
            </li>
            <li class="page-item" [class.disabled]="paginator.pageIndex === 0">
              <a class="page-link" href="#" (click)="paginator.previousPage()">Anterior</a>
            </li>
            <li class="page-item" [class.disabled]="!paginator.hasNextPage()">
              <a class="page-link" href="#" (click)="paginator.nextPage()">Siguiente</a>
            </li>
            <li class="page-item" [class.disabled]="!paginator.hasNextPage()">
              <a class="page-link" href="#" (click)="paginator.lastPage()">Última</a>
            </li>
          </ul>
        </nav>
      </div>
      <!-- END TABLA -->
    </div>
    <!-- menu derecho -->
    <mat-drawer #drawer class="sidenav px-3" mode="over" position="end">
      <div class="d-flex align-items-center my-4 gap-3">
        <mat-icon>filter_list_alt</mat-icon>
        <h2 class="my-0">Filtro de Clientes</h2>
      </div>
      <form [formGroup]="form" (ngSubmit)="applyFilter()" class="d-flex flex-column gap-3">
        <div class="d-flex flex-column">
          <div class="mb-2 d-flex flex-column gap-3">
            <!-- Autocompletado -->
            <mat-form-field subscriptSizing="dynamic" class="">
              <mat-label>Cliente</mat-label>
              <input formControlName="ClienteFilterControl" matInput>
            </mat-form-field>
            <!-- Autocompletado -->
            <mat-form-field subscriptSizing="dynamic" class="">
              <mat-label>Población</mat-label>
              <input formControlName="PoblacionFilterControl" matInput>
            </mat-form-field>
            <!-- autocompletado -->
            <mat-form-field subscriptSizing="dynamic" class="">
              <mat-label>Provincia</mat-label>
              <input formControlName="ProvinciaFilterControl" matInput>
            </mat-form-field>
            <!-- select -->
            <mat-form-field subscriptSizing="dynamic" class="">
              <mat-label>CP</mat-label>
              <input formControlName="CpFilterControl" matInput>
            </mat-form-field>
          </div>
          <div class="content-end gap-2 d-flex mt-2">
            <button (click)="filtroReset()" class="buttons-clients text-white" mat-button>Limpiar</button>
            <button (click)="drawer.toggle()" class="buttons-clients text-white" mat-button>Cancelar</button>
          </div>
        </div>
      </form>
    </mat-drawer>
  </mat-drawer-container>
</div>
