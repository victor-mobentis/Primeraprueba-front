<div class="screen">
  <div class="separador-superior"></div>
  <div class="">
    <div class="d-flex justify-content-between m-4">
      <h1 class="mb-0">
        <img class="icon-title" src="assets/images/iconos/clientes-icon-dark.svg" alt="Clientes" matListItemIcon />
        <span class=" mb-0 ps-2 color-dark page-heading">Clientes</span>
      </h1>
    </div>


    <div class="m-3">
      <div class="d-flex align-items-center justify-content-between gap-5 mb-3">
        <!-- buscador -->
        <div class="d-flex gap-3 align-items-center">
          <div class="input-group" id="busqueda">
            <input class="form-control border-end-0 border" type="search" placeholder="Buscar..."
              id="example-search-input">
            <span class="input-group-append">
              <button class="btn btn-outline-secondary bg-white border-start-0 border-bottom-0 border ms-n5"
                type="button">
                <i class="fa fa-search"></i>
              </button>
            </span>
          </div>
          <!-- boton de filtros aplicados o limpiar -->
        <app-filter-container [componentId]="'clients-general'" (filtersChanged)="onFiltersChanged($event)">
        </app-filter-container>
        </div>

        <!-- botones de  filtros y mapa -->
        <div class="boton-filtro d-flex gap-2 align-self-start me-3">
          <button ngbTooltip="Ver en Mapa" class="btn btn-color d-flex justify-content-center align-items-center gap-2"
            (click)="verEnMapa()">
            <mat-icon>location_on</mat-icon>
          </button>
<!--           <button ngbTooltip="Ver filtros" class="btn btn-secondary d-flex align-items-center" data-bs-toggle="modal"
            data-bs-target="#filtroModal">
            <mat-icon class="p-0 m-0">filter_list_alt</mat-icon>
          </button> -->
        </div>

      </div>
      <!-- tabla -->
      <div class="table-responsive {{cargando?'d-none':''}}">
        <table class="table table-hover table-sm">
          <!-- Checkbox Column -->
          <thead>
            <tr>
              <th class="th-checkbox row_column_checkbox text-center px-2">
                <div class="d-flex align-items-center">
                  <input type="checkbox" (change)="masterToggle()" [checked]="selection.hasValue() && isAllSelected()"
                    [indeterminate]="selection.hasValue() && !isAllSelected()">
                </div>
              </th>
              <th scope="col" class="row_column_sm cursor" (click)="sortData('customer_ERP_id')">
                C贸digo
                <i *ngIf="sortColumn === 'customer_ERP_id'" class="bi" [ngClass]="sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'"></i>
              </th>
              <th scope="col" class="cursor row_column_lg" (click)="sortData('name')">
                Nombre
                <i *ngIf="sortColumn === 'name'" class="bi" [ngClass]="sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'"></i>
              </th>
              <th scope="col" class="row_column_md cursor" (click)="sortData('province')">
                Provincia
                <i *ngIf="sortColumn === 'province'" class="bi" [ngClass]="sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'"></i>
              </th>
              <th scope="col" class="row_column_md cursor" (click)="sortData('city')">
                Poblaci贸n
                <i *ngIf="sortColumn === 'city'" class="bi" [ngClass]="sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'"></i>
              </th>
              <th scope="col" class="row_column_sm cursor" (click)="sortData('pc')">
                C.P.
                <i *ngIf="sortColumn === 'pc'" class="bi" [ngClass]="sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'"></i>
              </th>
              <th scope="col" class="cursor row_column_xl" (click)="sortData('address')">
                Direcci贸n
                <i *ngIf="sortColumn === 'address'" class="bi" [ngClass]="sortDirection === 'asc' ? 'bi-arrow-up' : 'bi-arrow-down'"></i>
              </th>
              <th scope="col" class="text-center row_column_sm">Ficha</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let row of paginatedData">
              <tr>
                <td class="text-center px-2">
                  <div class="d-flex align-items-center">
                    <input type="checkbox" (click)="$event.stopPropagation()" (change)="selection.toggle(row)"
                      [checked]="selection.isSelected(row)" [disabled]="isCheckboxDisabled(row)">
                  </div>
                </td>
                <td>{{ row.customer_ERP_id }}</td>
                <td [title]="row.name">
                  {{ row.name }}
                </td>
                <td [title]="row.province">
                  {{ row.province }}
                </td>
                <td [title]="row.city">
                  {{ row.city }}
                </td>
                <td>{{ row.pc != 0 ? row.pc : "" }}</td>
                <td [title]="row.address">
                  {{ row.address }}
                </td>
                <td class="text-center">
                  <button class="btn btn-link p-0" (click)="editClient(row.id)" title="Ficha">
                    <i class="bi bi-eye-fill fs-5 icon_color cursor"></i>
                  </button>
                </td>
              </tr>

            </ng-container>
          </tbody>
        </table>

      </div>
      <div class="d-flex justify-content-center {{cargando?'':'d-none'}}">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>

      <!-- Componente de paginaci贸n externo -->
      <app-pagination [totalItems]="dataSource.data.length" [itemsPerPage]="itemsPerPage" [currentPage]="currentPage"
        (pageChange)="onPageChange($event)" (itemsPerPageChanged)="onItemsPerPageChanged($event)">
      </app-pagination>

    </div>
  </div>
</div>