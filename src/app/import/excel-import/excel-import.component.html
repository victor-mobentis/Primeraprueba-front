<div class="background-light-gray screen p-2">
  <input id="boton" class="d-none" type="file" accept=".xlsx, .csv, .xls" (change)="handleFileInputChange($event)">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
      <!-- Botón para volver -->
      <button class="btn btn-link" (click)="volverAConfig()">
        <i class="bi bi-arrow-left dadrk-gray"></i>
      </button>
      <!-- Apartado: nombre de las hojas, seleccion de tablas y boton de seleccionar archivo -->
      <div *ngIf="selectedSheet" class="d-flex align-items-center">
        <!-- select para seleccionar hoja de la tabla de excel -->
        <div class="d-flex gap-2 p-1" *ngIf="ExcelData.length > 1">
          <select
            id="sheetSelector"
            class="form-select form-select-sm"
            [(ngModel)]="selectedSheet"
            (change)="showTable(selectedSheet.name)">
            <option *ngFor="let sheet of ExcelData" [ngValue]="sheet">
              {{ sheet.name }}
            </option>
          </select>
        </div>
        
        <!-- Si hay solo una hoja, mostrar su nombre en un H2 -->
        <h2 *ngIf="ExcelData.length === 1" class="m-0">{{ ExcelData[0]?.name }}</h2>
      
        <h2 *ngIf="selectedSheet" class="m-0 px-3">-</h2>
        <!-- Contenedor para el selector y el icono -->
        <div class="d-flex align-items-center ps-1">
          <!-- Selector de tabla -->
          <select class="form-select form-select-sm" [(ngModel)]="tablaActiva" (change)="cambiarTablaCabecera()" [disabled]="!selectedSheet">
            <option [value]="-1" disabled hidden>-- Seleccione una tabla --</option>
            <option *ngFor="let tabla of tablasMobentis; let i = index" [value]="i">
              {{ tabla }}
            </option>
          </select>
          <!-- Icono de información con tooltip -->
          <i class="bi bi-info-circle ms-2"
            ngbTooltip="Selecciona el tipo de dato que contiene el archivo seleccionado y que deseas importar"></i>
        </div>
        <!-- Botón para seleccionar archivo -->
        <button class="btn btn-sm btn-primary ms-3" (click)="abrirInput()">Seleccionar archivo</button>
      </div>
    </div>
    <!-- Botón de importación -->
    <button class="btn  btn-sm btn-primary" [disabled]="!selectedSheet" (click)="importar()">Importar
      Selección</button>
    </div>

  <div 
    *ngIf="!selectedSheet" 
    class="placeholder-box d-flex justify-content-center align-items-center flex-column"
    [class.drag-over]="isDragging"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave()"
    (drop)="onFileDrop($event)"  
  >
    <i class="bi bi-cloud-upload-fill mb-4" style="font-size: 40px;"></i>
    <h2 class="mb-2">Seleccione un archivo Excel<br/>o</h2>
    <button class="btn btn-sm btn-primary " (click)="abrirInput()">Seleccionar archivo</button>
  </div>

  <!-- Tabla de datos seleccionados -->
  <div *ngIf="selectedSheet " class="contenedor-tabla">
    <!-- Tabla de "Cabeceras" -->
    <table class="table  mb-2">
      <thead class="sticky-header-top">
        <tr>
          <th *ngFor="let emparejamientoDeCampo of listaDeEmparejamientoDeCampos" class="p-1">
            <select class="form-select w-100" [(ngModel)]="emparejamientoDeCampo.destino"
              (change)="borrarSeleccionesSimilares(emparejamientoDeCampo)" [disabled]="tablaActiva === -1 || camposTablaSeleccionada.length === 0">
              <option value="" disabled hidden selected>-- Selecciona el campo --</option>
              <option *ngFor="let campo of camposTablaSeleccionada" [value]="campo">{{ campo }}</option>
            </select>
          </th>
        </tr>
      </thead>
    </table>
    <!-- Tabla de vista previa de datos -->
    <table class="table table-bordered mt-0">
      <thead class="sticky-header">
        <tr>
          <th *ngFor="let columnName of getColumnNames()" [title]="columnName.length > 18 ? columnName : ''" class="color-primary">
            {{ columnName }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of selectedSheet.sheetName">
          <td *ngFor="let columnName of getColumnNames()"> {{ row[columnName] }} </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>