<div class="py-5 px-2 h-100 fondo" (window:resize)="onResize()">
  <div class="d-flex mx-4 mt-4 mb-0 justify-content-between">
    <div class=" col-5 container m-0  p-0"> <!-- col-9-->
      <div class="row align-items-center">
        <img class="col-1 icon-title p-0 my-4" src="assets/images/iconos/dashboard-icon-dark.svg" alt="Dashboard"
          matListItemIcon />
        <div class=" col d-flex justify-content-evenly kpis p-0">
          <div class="d-flex flex-column m-1">
            <div class="text-center numeroKPI">
              2.865
            </div>
            <div class="text-center tituloKPI">Clientes</div>
          </div>
          <!--
          <div class="border my-2">
          </div>
          <div class="d-flex flex-column m-1">
            <div class="text-center numeroKPI">
              29.230
            </div>
            <div class="text-center tituloKPI">Att. Cliente</div>
          </div>
          -->
          <div class="border my-2">
          </div>
          <div class="d-flex flex-column m-1">
            <div class="text-center numeroKPI">
              66.860
            </div>
            <div class="text-center tituloKPI">Rechazos</div>
          </div>
          <div class="d-flex flex-column m-1">
            <div class="text-center numeroKPI">
              250
            </div>
            <div class="text-center tituloKPI">Rechazos/día</div>
          </div>
          <!--<div class="border my-2">
          </div>
          <div class="d-flex flex-column m-1">
            <div class="text-center numeroKPI">
              12.543 €
            </div>
            <div class="text-center tituloKPI">Ventas/día</div>
          </div>
          <div class="d-flex flex-column m-1">
            <div class="text-center numeroKPI">
              2.385.245 €
            </div>
            <div class="text-center tituloKPI">Ventas</div>
          </div>
        -->
        </div>
      </div>
    </div>

    <div class="col-2 align-self-center d-flex justify-content-end">
      <button type="button" class="btn btn-secondary pb-0" (click)="toggleFiltro()">
        <mat-icon class="p-0 m-0">filter_list_alt</mat-icon>
      </button>
    </div>
  </div>

  <!-- filtro -->
  <div *ngIf="isFiltroActive" class="fondo-blanco">
    <form [formGroup]="filtro" (ngSubmit)="applyFilter()" class="col-12 d-flex flex-column p-3">
      <div class="container">
        <div class="row gx-2">
          <div class="col">
            <mat-form-field subscriptSizing="dynamic" class="col-12">
              <mat-label>Rango de fechas</mat-label>
              <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                <input formControlName="start" matStartDate placeholder="Desde">
                <input formControlName="end" matEndDate placeholder="Hasta">
              </mat-date-range-input>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field *ngIf="s1.length>0" subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>{{s1[0].name}}</mat-label>
              <mat-select formControlName="segmentacion1FilterControl" multiple>
                <mat-option *ngFor="let s of s1" [value]="s.segmentation_value_id">{{s.segmentation_value}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field *ngIf="s2.length>0" subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>{{s2[0].name}}</mat-label>
              <mat-select formControlName="segmentacion2FilterControl" multiple>
                <mat-option *ngFor="let s of s2" [value]="s.segmentation_value_id">{{s.segmentation_value}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="row gx-2">
          <div class="col">
            <mat-form-field *ngIf="s3.length>0" subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>{{s3[0].name}}</mat-label>
              <mat-select formControlName="segmentacion3FilterControl" multiple>
                <mat-option *ngFor="let s of s3" [value]="s.segmentation_value_id">{{s.segmentation_value}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field subscriptSizing="dynamic" class="col-12" matTooltip="Introduzca el nombre del cliente">
              <mat-label>Cliente</mat-label>
              <input formControlName="cliente" matInput>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>Provincia</mat-label>
              <mat-select formControlName="provinciaFilterControl" multiple>
                <mat-option *ngFor="let provincia of provinciaList" [value]="provincia">{{provincia}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>
        <div class="row gx-2">

          <div class="col">
            <mat-form-field subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>Población</mat-label>
              <mat-select formControlName="poblacionFilterControl" multiple>
                <mat-option *ngFor="let poblacion of poblacionList" [value]="poblacion">{{poblacion}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>Vendedor</mat-label>
              <mat-select formControlName="agenteFilterControl" multiple>
                <mat-option *ngFor="let agente of agenteList" [value]="agente.id">{{agente.name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field subscriptSizing="dynamic" class="mb-2 col-12">
              <mat-label>Familia</mat-label>
              <mat-select formControlName="familiaFilterControl" multiple>
                <mat-option *ngFor="let familia of familiaList" [value]="familia">{{familia}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>

        <div class="col justify-content-end gap-2 d-flex mt-2">
          <button mat-raised-button color="light" type="submit" (click)="applyFilter()" cdkFocusInitial>Filtrar</button>
          <button mat-raised-button color="light" (click)="resetFilter()" mat-button>Limpiar</button>
          <button mat-raised-button color="light" (click)="toggleFiltro()" mat-button>Cancelar</button>
        </div>
      </div>

    </form>
  </div>

  <div class="container d-grid gap-3 mt-3">
    <div class="row">
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco"><app-grafica-clientes></app-grafica-clientes></div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco"><app-grafica-pedidos></app-grafica-pedidos></div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco">
          <app-grafica-pedidos-familias-productos></app-grafica-pedidos-familias-productos>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco">
          <app-grafica-pedidos-segmentacion1></app-grafica-pedidos-segmentacion1>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco">
          <app-grafica-pedidos-segmentacion2></app-grafica-pedidos-segmentacion2>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco ">
          <app-grafica-pedidos-segmentacion3 class=""></app-grafica-pedidos-segmentacion3>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco">
          <app-grafica-productos-top></app-grafica-productos-top>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco">
          <app-grafica-pedidos-mes class=""></app-grafica-pedidos-mes>

        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s fondo-blanco">
          <app-grafica-pedidos-dia></app-grafica-pedidos-dia>

        </div>
      </div>
    </div>

  </div>

  <div class="fondo-blanco p-3 mt-3">
    <div>
      <mat-form-field class="col-3">
        <mat-label>Mostrar: </mat-label>
        <mat-select [(value)]="tablaActiva" (selectionChange)="select($event.value)">
          <mat-option *ngFor="let nombre of nombresTablas" [value]="nombresTablas.indexOf(nombre)">
            {{nombre}}</mat-option>
        </mat-select>
      </mat-form-field>
      <div>
        <div class="table-container">
          <table mat-table [dataSource]="dataSource">
            <!-- Columna Dinámica para 'nombre' -->
            <ng-container matColumnDef="nombre" sticky>
              <th mat-header-cell *matHeaderCellDef class="mat-column-nombre">{{ nombresTablas[tablaActiva] }}</th>
              <td mat-cell *matCellDef="let element" matTooltip="{{element.name}}"
                [matTooltipDisabled]="element.name?.length <= 32">{{ element.nombre }}</td>
            </ng-container>

            <!-- Columna para 'total' -->
            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef class="mat-column-rechazos text-end">Total</th>
              <td class="text-end" mat-cell *matCellDef="let element">{{ element.total }}</td>
            </ng-container>

            <!-- Columnas dinámicas de tipos de rechazos -->
            <ng-container *ngFor="let columna of columnasRechazos" [matColumnDef]="columna">
              <th class="text-end mat-column-rechazos " mat-header-cell *matHeaderCellDef> {{ columna }} </th>
              <td class="text-end" mat-cell *matCellDef="let element"> {{ element.rechazos[columna] || 0 }} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columnasDinamicas"></tr>
            <tr mat-row *matRowDef="let row; columns: columnasDinamicas;"></tr>
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="4">No hay datos que mostrar</td>
            </tr>
          </table>
        </div>
        <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons
          MatPaginatorIntl="Select page of users"></mat-paginator>
      </div>


    </div>

  </div>
</div>