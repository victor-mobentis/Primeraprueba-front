<div class=" background-light-gray">
  <div
    class="d-flex flex-column gap-2 flex-xl-row justify-content-between align-items-center p-2 titulo bg-white">
    <!-- titulo y icono -->
    <div class="d-flex align-items-center justify-content-start ">
      <img class="col-1 icon-title p-0 my-4" src="assets/images/iconos/dashboard-icon-dark.svg" alt="Dashboard"
        matListItemIcon />
      <h1 class="mb-0 dark-gray page-heading">Dashboard</h1>
    </div>
    <div class="max-w-kpi">
      <app-kpi></app-kpi>
    </div>
  </div>
  <div>
    <!-- boton de filtros aplicados o limpiar -->
    <app-filter-container [componentId]="'dashboard-general'" (filtersChanged)="onFiltersChanged($event)">
    </app-filter-container>
  </div>
  <div class="container d-grid gap-3 mt-3">
    <div class="row">
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-pastel [titulo]="'Clientes'"
            [datos]="[{ value: 1324, name: 'Con rechazos' }, { value: 570, name: 'Sin rechazos' }]"
            [elementoId]="'graficoClientes'"></app-grafica-pastel>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-semi-circulo [titulo]="'Motivos de Rechazo'"
            [valores]="[{ value: 23136, name: 'Packaging' }, { value: 18370, name: 'Mala calidad' }, { value: 17224, name: 'Precio' }, { value: 8130, name: 'No aplica' }]"
            [elementoId]="'motivos-rechazo'"></app-grafica-semi-circulo>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-horizontal [titulo]="'Familias de productos'"
            [categorias]="['Conservas', 'Verduras', 'Congelados', 'Vinos', 'Carnes', 'Frutas']"
            [valores]="[11600, 18460, 12300, 7200, 7100, 10200]"
            [elementoId]="'rechazos-faimlias'"></app-grafica-barra-horizontal>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-horizontal [titulo]="'Potencialidad'" [categorias]="['D', 'C', 'B', 'A']"
            [valores]="[11210, 8123, 32522, 15005]"
            [elementoId]="'rechazos-segmentacion-1'"></app-grafica-barra-horizontal>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-horizontal [titulo]="'Tipología'"
            [categorias]="['Tienda Alimentacion Minorista', 'Personal Empresa', 'OCIO', 'Mayoristas', 'Bar/Tapas']"
            [valores]="[10700, 15300, 6010, 24700, 10530]"
            [elementoId]="'rechazos-segmentacion-2'"></app-grafica-barra-horizontal>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-horizontal [titulo]="'Imagen'" [categorias]="['Tradicional', 'Moderna', 'Emblemática']"
            [valores]="[24680, 22000, 20000]" [elementoId]="'rechazos-segmentacion-3'"></app-grafica-barra-horizontal>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-horizontal [titulo]="'Top de productos'"
            [categorias]="['Aceite de oliva Arbequina', 'Miel de azahar', 'Lentejas Las Charras', 'Loctite 243', 'Bombones La Despensa de Palacio', 'Leche Pascual Semidesnatada', 'Mermelada plátano Román', 'Barbacoa', 'Pattex 120', 'Naturfresh Italiana']"
            [valores]="[6686, 1500, 12058, 7500, 6686, 6686, 6686, 6686, 6686, 6686]"
            [elementoId]="'rechazos-producto'"></app-grafica-barra-horizontal>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-vertical [titulo]="'Por mes'"
            [categorias]="['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic']"
            [valores]="[0, 0, 0, 0, 5860, 18000, 43000]" [elementoId]="'rechazos-mes'"></app-grafica-barra-vertical>
        </div>
      </div>
      <div class="col-4">
        <div class="contenedor-grafica-s background-white rounded-4">
          <app-grafica-barra-vertical [titulo]="'Por día de la semana'"
            [categorias]="['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom']"
            [valores]="[12346, 15035, 9120, 6500, 6303, 9350, 8206]"
            [elementoId]="'rechazos-dia'"></app-grafica-barra-vertical>
        </div>
      </div>
    </div>
  </div>

  <div class="background-white rounded-4 p-3 mt-3">
    <div>
      <div class="form-group col-3">
        <select id="tablaActiva" class="form-select form-select-sm" [(ngModel)]="tablaActiva" (change)="select($event)">
          <option *ngFor="let nombre of nombresTablas; let i = index" [value]="i">
            {{ nombre }}
          </option>
        </select>
      </div>
      <div>
        <div class="table-responsive">
          <table class="table table-hover table-sm my-0">
            <!-- Columna Dinámica para 'nombre' -->
            <thead>
              <tr>
                <th class="sticky-left">{{ nombresTablas[tablaActiva] }}</th>
                <th class="text-end sticky-left">Total</th>

                <!-- Columnas dinámicas de tipos de rechazos -->
                <th *ngFor="let columna of columnasRechazos" class="text-end column-rechazos"> {{ columna }} </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let element of paginadorData">
                <td class="sticky-left" [title]="element.nombre"
                  [attr.data-toggle]="element.nombre.length > 32 ? 'tooltip' : ''">
                  {{ element.nombre }}
                </td>
                <td class="sticky-left text-end">{{ element.total }}</td>

                <!-- Celdas dinámicas de rechazos -->
                <td class="text-end column-rechazos" *ngFor="let columna of columnasRechazos">
                  {{ element.rechazos[columna] || 0 }}
                </td>
              </tr>

              <!-- Fila sin datos -->
              <tr *ngIf="paginadorData.length === 0">
                <td colspan="4" class="text-center">No hay datos que mostrar</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Componente de Paginación -->
        <app-pagination [totalItems]="data.length" [itemsPerPage]="itemsPerPage" [currentPage]="currentPage"
          (pageChange)="changePage($event)" (itemsPerPageChanged)="onItemsPerPageChanged($event)">
        </app-pagination>
      </div>
    </div>
  </div>